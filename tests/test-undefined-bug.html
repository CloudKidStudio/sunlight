<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>BLARGH!! for the people   &raquo; Linq Walk</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="WordPress 2.9.2" /> <!-- leave this for stats -->
  <link rel="stylesheet" href="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/style.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="../src/themes/sunlight.default.css" type="text/css" />
  <!--[if IE]><link rel="stylesheet" href="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/ie.css" type="text/css" media="screen" /><![endif]-->

  <link rel="pingback" href="http://blargh.tommymontgomery.com/xmlrpc.php" />
  <link rel="alternate" type="application/rss+xml" title="BLARGH!! for the people RSS 2.0 Feed" href="http://blargh.tommymontgomery.com/feed/" />
  <link rel="alternate" type="text/xml" title="BLARGH!! for the people RSS Feed" href="http://blargh.tommymontgomery.com/feed/rss/" />
  <link rel="alternate" type="application/atom+xml" title="BLARGH!! for the people Atom 0.3" href="http://blargh.tommymontgomery.com/feed/atom/" />
  <link rel="alternate" type="application/rss+xml" title="BLARGH!! for the people &raquo; Linq Walk Comments Feed" href="http://blargh.tommymontgomery.com/2010/03/linq-walk/feed/" />
<script type='text/javascript' src='http://acronymulator.com/63/gz?ver=2.9.2'></script>
<script type='text/javascript' src='http://linkurious.com/js/gz?ver=2.9.2'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blargh.tommymontgomery.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blargh.tommymontgomery.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='BLARGH!! for the people' href='http://blargh.tommymontgomery.com' />

<link rel='start' title='How Embarrassing' href='http://blargh.tommymontgomery.com/2009/06/how-embarrassing/' />
<link rel='prev' title='Sudoku Solver: 2006-style' href='http://blargh.tommymontgomery.com/2010/03/sudoku-solver-2006-style/' />
<link rel='next' title='Get Computed Style in JavaScript' href='http://blargh.tommymontgomery.com/2010/04/get-computed-style-in-javascript/' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel='canonical' href='http://blargh.tommymontgomery.com/2010/03/linq-walk/' />
  </head>

<body>
<div id="wrapper"><div id="min-width"><!-- wrapper -->
  <div id="header">

      <div id="header-logo">

        <a href="http://blargh.tommymontgomery.com" title="BLARGH!! for the people">
          <div id="header-logo-gravatar">
            			<img class="avatar avatar-78 photo" height="78" width="78" src="http://static.tommymontgomery.com/images/wordpress/avatar.jpeg"/>
          </div>
        </a>
      </div>

      <div id="header-title">
        <a href="http://blargh.tommymontgomery.com/feed/rss/" title="Subscribe to the Blog Feed (RSS)" rel="nofollow"><img src="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/img/feed_big.gif" alt="RSS Feed" style="float: right; margin: 8px 10px 0 10px;" /></a>

        <h1><a href="http://blargh.tommymontgomery.com">BLARGH!! for the people</a></h1>
        <h2><a href="http://blargh.tommymontgomery.com">It&#039;s time to bring forth the rhythm and the rhyme</a></h2>
      </div>

      <div id="header-navi">
        <!-- <ul>
          <li class="page_item"><a href="http://blargh.tommymontgomery.com" title="BLARGH!! for the people">Home</a></li>
                  </ul> -->
        <ul id="dropmenu">
          <li class="page_item"><a href="http://blargh.tommymontgomery.com" title="BLARGH!! for the people">Home</a></li>

                  </ul>
      </div>

  </div>
<!-- /HEADER -->
<!-- <div style="float:left;"> -->

  <!-- ���� ����� �������� ������������ ��� ����� ��������� -->

<!-- </div> -->	
<!-- CONTENT -->

  <div id="content-wrapper">

    <div id="content">
  						<h1>Linq Walk</h1>

				<p>So, we all know <a href="http://msdn.microsoft.com/en-us/netframework/aa904594.aspx">Linq</a> is rad. Not in that silly faux-SQL syntax, but in the manly, declarative, fluent syntax.</p>
<p>But the sad part is that there is no <kbd>walk</kbd> extension method. Walk is a functional programming staple that iterates over a collection of stuff and applies a callback to each one. In PHP, there is <a href="http://php.net/manual/en/function.array-walk.php"><kbd>array_walk</kbd></a>, in JavaScript there is <a href="http://javascriptkit.com/jsref/arrays.shtml"><kbd>each</kbd></a>.</p>

<p>You might be thinking, &#8220;but there is a <kbd>ForEach()</kbd> extension method on <kbd>List</kbd>!&#8221;. And you would be wrong, because there is a subtle, yet important difference between <kbd>IEnumerable</kbd> and <kbd>IList</kbd>.</p>
<p><kbd>IEnumerable</kbd> is late-binding. That means you can do whatever you want to it, but execution is deferred until you actually enumerate the enumeration, i.e. using a <kbd>foreach</kbd> construct. In a list, there is no deferred execution. This deferred execution is accomplished through the magic of closures and expression trees. Read up on them.</p>

<p>In the meantime, here is a fluent implementation of <kbd>walk</kbd>:</p>
<pre class="sunlight-highlight-csharp">public static class LinqExtensions {
	public static IEnumerable&lt;T&gt; Walk&lt;T&gt;(this IEnumerable&lt;T&gt; source, Action&lt;T&gt; action) {
		foreach (var t in source) {
			action(t);
			yield return t;
		}
	}
}</pre>

<p>You can prove that this is in fact using deferred execution with a simple test:</p>
<pre class="sunlight-highlight-csharp">class Program {

	class Foo {
		public int Bar { get; set; }

		public override string ToString() {
			return string.Format("Foo(Bar={0})", Bar);
		}
	}

	static void Main() {
		IEnumerable&lt;Foo&gt; foos = new[] { new Foo { Bar = 2 }, new Foo { Bar = 1 }, new Foo { Bar = 3 } };

		Console.WriteLine("IEnumerable.Walk():");
		foos.Walk(Console.WriteLine);
		Console.WriteLine();

		Console.WriteLine("List.ForEach():");
		foos.ToList().ForEach(Console.WriteLine);
		Console.WriteLine();

		Console.ReadLine();
	}

}</pre>
<p>The output looks like this:<br />
<img src="http://blargh.tommymontgomery.com/wp-content/uploads/2010/03/linqwalk1.png" alt="linqwalk" title="linqwalk" width="287" height="123" class="aligncenter size-full wp-image-468" /></p>
<p>Notice that nothing got printed the first time through, using the <kbd>Walk()</kbd> extension method. There&#8217;s your deferred execution. That means our extension method did not enumerate the enumeration, so it&#8217;s safe and efficient to use walk in a normal linq expression where you are depending on deferred execution, like this:</p>

<pre class="sunlight-highlight-csharp">
IEnumerable&lt;Foo&gt; foos = new[] { new Foo { Bar = 2 }, new Foo { Bar = 1 }, new Foo { Bar = 3 } };

Console.WriteLine("Doing more stuff:");
var listOStuff = foos
	.Where(foo =&gt; foo.Bar &gt;= 2)
	.Walk(foo =&gt; foo.Bar += 10)
	.Select(foo =&gt; new Baz { Foofy = foo })
	.Walk(baz =&gt; baz.Foofy.Bar--)
	.OrderBy(baz =&gt; baz.Foofy.Bar);

foreach (var stuff in listOStuff) {
	Console.WriteLine(stuff);
}

Console.ReadLine();</pre>

<p><img src="http://blargh.tommymontgomery.com/wp-content/uploads/2010/03/linqwalk2.png" alt="linqwalk2" title="linqwalk2" width="360" height="110" class="aligncenter size-full wp-image-466" /></p>
<p>Well, maybe that&#8217;s not &#8220;normal.&#8221; Whatever.</p>
				    			<p id="postmeta">
					  <img src="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/img/calendar.gif" /><a href="http://blargh.tommymontgomery.com/2010/03/" title="View all posts for the month of March, 2010">March 24, 2010</a>
					  &nbsp;<img src="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/img/tag.gif" />            Posted&nbsp;in:&nbsp;<a href="http://blargh.tommymontgomery.com/category/c/" title="View all posts in c#" rel="category tag">c#</a>					  <!-- &nbsp;<img src="http://blargh.tommymontgomery.com/wp-content/themes/emerald-stretch/img/comments.gif" /><a href="http://blargh.tommymontgomery.com/2010/03/linq-walk/#comments" title="Comment on Linq Walk">One Comment</a> -->

					  <span class="editlink"></span>
				  </p>
  			


<div id="comments">
			<h1>One Response</h1>
		<div id="comment-area">
			<ol>
							<li class="alt " id="comment-604">
					
					<p class="commenter"> <a href='http://tommymontgomery.com/' rel='external nofollow' class='url'>tmont</a><span class="comment-info"> - March 26, 2010</span></p>

										<p>Thanks to <a href="http://agileatwork.com/" rel="nofollow">Mike</a> for the idea of using <kbd>foreach</kbd> rather than <kbd>enumerator.MoveNext()</kbd>. Not completely sure why I didn&#8217;t think of that&#8230;</p>
				</li>

				
						</ol>

		</div>

	
	
			<div id="comment-form">
			<h1>Leave a Reply</h1>
					<form action="http://blargh.tommymontgomery.com/wp-comments-post.php" method="post" id="commentform">
			        <p><input type="text" name="author" id="author" value="" size="30" tabindex="1" aria-required='true' />
        <label for="author">Name, required</label></p>
        <p><input type="text" name="email" id="email" value="" size="30" tabindex="2" aria-required='true' />

        <label for="email">Email (will not be published), required</label></p>
        <p><input type="text" name="url" id="url" value="" size="30" tabindex="3" />
        <label for="url">Website (if present)</label></p>
							<p><textarea name="comment" id="comment" cols="60" rows="10" tabindex="4"></textarea></p>
								<p>
					<input name="submit" class="button" type="submit" id="submit" tabindex="5" value="Submit" />
					<input type="hidden" name="comment_post_ID" value="460" />

				</p>
		</form>
	</div>
	</div>

      <br />
 			<ul class="postnav">
 	  		<li class="left"><a href="http://blargh.tommymontgomery.com/2010/03/sudoku-solver-2006-style/" rel="prev">&laquo; Previous post</a></li>

   	  	<li class="right"><a href="http://blargh.tommymontgomery.com/2010/04/get-computed-style-in-javascript/" rel="next">Next post &raquo;</a></li>
		  </ul>

 		  
    </div>
<!-- /CONTENT -->
<!-- RIGHT SIDEBAR -->

    <div id="sidebar-right">
      <ul>

        	
    			<li>

    				<h2>Categories</h2>
    				<ul>
    						<li class="cat-item cat-item-11"><a href="http://blargh.tommymontgomery.com/category/apache/" title="View all posts filed under apache">apache</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://blargh.tommymontgomery.com/category/c/" title="View all posts filed under c#">c#</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://blargh.tommymontgomery.com/category/coders-at-work/" title="View all posts filed under coders at work">coders at work</a>
</li>

	<li class="cat-item cat-item-20"><a href="http://blargh.tommymontgomery.com/category/java/" title="View all posts filed under java">java</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://blargh.tommymontgomery.com/category/javascript/" title="View all posts filed under javascript">javascript</a>
</li>
	<li class="cat-item cat-item-21"><a href="http://blargh.tommymontgomery.com/category/lulz/" title="View all posts filed under lulz">lulz</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://blargh.tommymontgomery.com/category/math/" title="View all posts filed under math">math</a>
</li>
	<li class="cat-item cat-item-22"><a href="http://blargh.tommymontgomery.com/category/nginx/" title="View all posts filed under nginx">nginx</a>

</li>
	<li class="cat-item cat-item-5"><a href="http://blargh.tommymontgomery.com/category/php/" title="View all posts filed under php">php</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://blargh.tommymontgomery.com/category/rants/" title="View all posts filed under rants">rants</a>
</li>
	<li class="cat-item cat-item-12"><a href="http://blargh.tommymontgomery.com/category/reviews/" title="View all posts filed under reviews">reviews</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://blargh.tommymontgomery.com/category/subversion/" title="View all posts filed under subversion">subversion</a>
</li>

	<li class="cat-item cat-item-15"><a href="http://blargh.tommymontgomery.com/category/testing/" title="View all posts filed under testing">testing</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://blargh.tommymontgomery.com/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://blargh.tommymontgomery.com/category/unicode/" title="View all posts filed under unicode">unicode</a>
</li>
	<li class="cat-item cat-item-23"><a href="http://blargh.tommymontgomery.com/category/unity/" title="View all posts filed under unity">unity</a>
</li>
	<li class="cat-item cat-item-9"><a href="http://blargh.tommymontgomery.com/category/web-development/" title="View all posts filed under web development">web development</a>

</li>
	<li class="cat-item cat-item-3"><a href="http://blargh.tommymontgomery.com/category/windows/" title="View all posts filed under windows">windows</a>
</li>
    				</ul>
    			</li>

          <li>
    				<h2>Archives</h2>
    				<ul>

    						<li><a href='http://blargh.tommymontgomery.com/2011/04/' title='April 2011'>April 2011</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2011/03/' title='March 2011'>March 2011</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/11/' title='November 2010'>November 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/07/' title='July 2010'>July 2010</a></li>

	<li><a href='http://blargh.tommymontgomery.com/2010/05/' title='May 2010'>May 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/04/' title='April 2010'>April 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2009/12/' title='December 2009'>December 2009</a></li>

	<li><a href='http://blargh.tommymontgomery.com/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2009/06/' title='June 2009'>June 2009</a></li>
    				</ul>

    			</li>

  				<li>
            <h2>Meta</h2>
    				<ul>
    					<li><a href="http://blargh.tommymontgomery.com/wp-login.php?action=register">Register</a></li>    					<li><a href="http://blargh.tommymontgomery.com/wp-login.php">Log in</a></li>
    					<li><a href="feed:http://blargh.tommymontgomery.com/feed/" title="Syndicate this site using RSS">Entries RSS</a></li>

    					<li><a href="feed:http://blargh.tommymontgomery.com/comments/feed/" title="The latest comments to all posts in RSS">Comments RSS</a></li>
    					    				</ul>
  				</li>

          <!--<h2>Search</h2>-->
          <ul>
<!-- <div align="center"> -->
<form method="get" id="searchform" action="http://blargh.tommymontgomery.com/">
		<!-- <input type="text" value="" name="s" id="s" size="20" /> -->
 		<input type="text" value="Search" name="s" id="s" size="20" onfocus="if (this.value == 'Search') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search';}" />

		<input type="submit" id="searchsubmit" value="Find" />
</form>
<!-- </div> -->
</ul>            
          
          <!-- <li><h2>Some Title Here</h2>
  <ul> -->

<!--   ---------------------- LINK ADS ---------------------- -->

  <!-- You can add here the link ads code -->

<!-- / ---------------------- LINK ADS ---------------------- -->

<!--   </ul>
</li>    -->       

      </ul>
    </div>

</div>

<!-- LEFT SIDEBAR -->

    <div id="sidebar-left">
      <ul>
  	    
				<li>
          <h2>Recent Posts</h2>
        	<ul>
        	  	<li><a href='http://blargh.tommymontgomery.com/2011/04/introducing-sunlight/' title='Introducing Sunlight'>Introducing Sunlight</a></li>

	<li><a href='http://blargh.tommymontgomery.com/2011/03/determining-if-an-open-generic-type-isassignablefrom-a-type/' title='Determining if an Open Generic Type IsAssignableFrom a Type'>Determining if an Open Generic Type IsAssignableFrom a Type</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2011/01/adding-two-numbers-is-not-a-helpful-example/' title='Adding Two Numbers Is Not a Helpful Example'>Adding Two Numbers Is Not a Helpful Example</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/12/retrieving-the-failing-element-from-a-call-to-ienumerable-all/' title='Retrieving the failing element from a call to IEnumerable&lt;T&gt;.All()'>Retrieving the failing element from a call to IEnumerable&lt;T&gt;.All()</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/12/non-magic-property-injection-in-unity/' title='Non-magic property injection in Unity'>Non-magic property injection in Unity</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/11/cyclomatic-complexity-is-worthless/' title='Cyclomatic Complexity is Worthless'>Cyclomatic Complexity is Worthless</a></li>

	<li><a href='http://blargh.tommymontgomery.com/2010/11/configure-nhibernate-with-embedded-resource/' title='Configure NHibernate with Embedded Resource'>Configure NHibernate with Embedded Resource</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/07/php-is-dead/' title='PHP is Dead'>PHP is Dead</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/05/refresh-current-page-in-javascript/' title='Refresh Current Page in JavaScript'>Refresh Current Page in JavaScript</a></li>
	<li><a href='http://blargh.tommymontgomery.com/2010/05/subversion-apache-nginx-and-entity-too-large/' title='Subversion, Apache, nginx and &#8220;Entity Too Large&#8221;'>Subversion, Apache, nginx and &#8220;Entity Too Large&#8221;</a></li>
        	</ul>
				</li>

  			<li>
         	<h2>Links</h2>
      		<ul>
      		  <li><a href="http://tommymontgomery.com/about" title="About me">About</a></li>
<li><a href="http://acronymulator.com/" title="It acronymulates!">Acronymulator</a></li>
<li><a href="http://tommymontgomery.com/" title="My personal site">Home</a></li>
<li><a href="http://linkurious.com/" title="Are you linkurious?">Linkurious</a></li>

<li><a href="http://phpmidiparser.com/" title="A MIDI Parsing library written in PHP">PHP MIDI Parser</a></li>
<li><a href="http://urmomisugly.com/" title="No further explanation is required">URMOM IS UGLY.</a></li>
      		</ul>
  			</li>

              </ul>
    </div>
	
<!-- FOOTER -->
</div></div><!-- /wrapper -->
    <div id="footer">
  	<p id="footer-left">&copy; <a href="http://blargh.tommymontgomery.com">BLARGH!! for the people</a>.</p>
		<p id="footer-right">

			Powered by 
			<a href="http://wordpress.org" title="wordpress.org">WordPressZOMG!</a>. 
			Theme: 
			<a href="http://masnikov.com/emerald_stretch">Emerald Stretch</a> 
			by  
			<a href="http://masnikov.com">Nikolaj Masnikov</a>.
			Hacked up by: <a href="http://tommymontgomery.com/" title="Word to your mutha">Tommy Montgomery</a>.
		</p>
  </div>

  <script type="text/javascript" src="../src/sunlight.js"></script>
  <script type="text/javascript" src="../src/sunlight.csharp.js"></script>

  <script type="text/javascript">Sunlight.highlightAll();</script>
</body>
</html>
